#!/bin/bash

# script directory
SCRIPT_DIR=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )

# qjump files 
DEFAULT_SAVE_FILE="$SCRIPT_DIR/.qjump_save"
if [ ! -f "$DEFAULT_SAVE_FILE" ]; then
    touch $DEFAULT_SAVE_FILE
fi

# argument check
if [ $# -lt 1 ] || [ $# -gt 2 ]; then
   echo "Incorrect usage!"
   echo "Usage: qjump [TARGET -- REQUIRED] [NEW DESTINATION - OPTIONAL]"
else 
   # read file
   INPUT=$DEFAULT_SAVE_FILE
   FOUND=0
   JUMPSTATUS=0
   LINENUM=1
   while IFS= read -r LINE
   do
     if [ $1 == "list" ]; then 
        echo $LINE 
     else 
      # split by space 
      LINEARRAY=($LINE)
      
      # check if matches input
      if [[ $1 == ${LINEARRAY[0]} ]]; then
         if [ $# -eq 1 ]; then
            cd "${LINEARRAY[1]}"
            JUMPSTATUS=$?
            FOUND=1
            break
         else
            sed -i'' -e ''${LINENUM}'d' $INPUT
            FOUND=0
            break
         fi
      fi
      LINENUM=$((LINENUM+1))
     fi 
   done < "$INPUT"
   
   # check if appending new target or output
   if [ ! $1=="list" ]; then 
      if [ $FOUND -eq 0 ] && [ $# -eq 2 ]; then
         echo "${1} ${2}" >> $INPUT
         echo "Added new target to save file!"
      elif [ $FOUND -eq 1 ] && [ $JUMPSTATUS -eq 0 ]; then
         echo "Jumped to target ${1}"
      elif [ $FOUND -eq 1 ] && [ $JUMPSTATUS -ne 0 ]; then
         echo "Incorrect jump path for ${1}"
      else
         echo "Failed to find target ${1}"
      fi
   fi 
fi 
